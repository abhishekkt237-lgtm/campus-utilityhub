<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <title>
      Set password
    </title>
    <style>
* {
  font-family: roboto, arial;
}
body{
  background-image: linear-gradient(135deg, rgb(180, 203, 203),rgba(180, 203, 203, 0.38), rgb(180, 203, 203));

}
.mainbox {
  background-color: rgb(62, 100, 100);
  width: 500px;
  height: 350px;
  margin:180px 0 0 520px;
  border-radius: 6px;
  box-shadow: 2px 2px 10px 5px rgba(0, 0, 0, 0.2);
}
.head {
  background-color: rgb(32, 52, 52);
  border-radius: 6px 6px 0 0;
  padding: 10px 0;
  text-align: center;
  font-size: 35px;
  font-weight: 500;
  color: aliceblue;
  box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
}
.setpass {
  padding: 40px 0 0 80px;
  
}
.pass {
  font-size: 18px;
  outline: none;
  width: 350px;
}
.submit {
  font-size: 17px;
  margin: 50px 0 0 185px;
  padding: 10px 13px;
  border: none;
  border-radius: 2px;
  background-color:rgb(32, 52, 52) ;
  color: aliceblue;
  box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
transition: all 0.15s;
}
.warning {
  color: rgb(208, 94, 94);
}
.submit:hover {
  background-color:rgb(25, 42, 42) ;
}

    </style>

  </head>

  <body>
    <div class="mainbox">
      <div class="head">
    Set New Password
      </div>
      <div class="setpass">
  <input class="pass"
  type="password" 
  id="newPassword" 
  placeholder="New Password"
>

<br>
<span class="warning">
  &#8226; Password must be of atleast 6 characters
  </span>
  <br><br>
<input class="pass"
  type="password" 
  id="confirmPassword" 
  placeholder="Confirm Password"
>
      </div>
<div>
  <button  class="submit" id="updatePassword">
  Set Password
</button>
    </div>
    </div>


  </body>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { 
  getAuth, 
  onAuthStateChanged, 
  EmailAuthProvider, 
  linkWithCredential 
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAVGVP0c6e9KMdp2RmqOeGGVxr8kFsXZ7M",
  authDomain: "campus-utility-hub-iitism.firebaseapp.com",
  projectId: "campus-utility-hub-iitism",
  storageBucket: "campus-utility-hub-iitism.firebasestorage.app",
  messagingSenderId: "281851939722",
  appId: "1:281851939722:web:62f0da477d4c2a917f5673"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

let currentUser = null;

// ðŸ” Protect page
onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login.html";
  } else {
    currentUser = user;
  }
});

document.getElementById("updatePassword").addEventListener("click", async () => {

  const password = document.getElementById("newPassword").value;
  const confirmPassword = document.getElementById("confirmPassword").value;

  // âœ… VALIDATIONS
  if (!password || !confirmPassword) {
    alert("Please fill both fields");
    return;
  }

  if (password.length < 6) {
    alert("Password must be at least 6 characters");
    return;
  }

  if (password !== confirmPassword) {
    alert("Passwords do not match");
    return;
  }

  try {
    const credential = EmailAuthProvider.credential(
      currentUser.email,
      password
    );

    await linkWithCredential(currentUser, credential);

    alert("Password set successfully. Please login again.");

    // ðŸ” LOGOUT + REDIRECT
    await auth.signOut();
    window.location.href = "login.html";

  } catch (error) {
    console.error(error);
    alert(error.message);
  }
});
</script>

</html>